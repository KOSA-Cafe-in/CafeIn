<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cafein.menu.mapper.MenuMapper">

<!-- 인터페이스와 매칭되는 쿼리 추가 (담당 : 손윤찬) -->
  <!-- 메뉴 등록 -->
  <insert id="createMenu" parameterType="com.cafein.menu.MenuDTO">
    INSERT INTO Menu (
      menuId, name, content, price, menuPictureUrl
    ) VALUES (
      MENU_SEQ.NEXTVAL,
      #{name}, #{content}, #{price}, #{menuPictureUrl, jdbcType=CLOB}
    )
  </insert>

  <!-- ✅ 인터페이스와 매칭되는 쿼리 추가 -->
  <select id="findAll" resultType="com.cafein.menu.MenuDTO">
    SELECT
      menuId         AS menuId,
      name           AS name,
      content        AS content,
      price          AS price,
      menuPictureUrl AS menuPictureUrl,
      createdDate    AS createdDate
      -- modifiedDate 컬럼이 DB에 있으면 아래 줄 주석 해제
      -- , modifiedDate  AS modifiedDate
    FROM Menu
    WHERE NVL(IS_DELETE, 'N') = 'N'
    ORDER BY createdDate DESC
  </select>

  <!-- (기존에 쓰고 있던 경우 유지) 메뉴 전체 조회 -->
  <select id="findAllMenus" resultType="com.cafein.menu.MenuDTO">
    SELECT
      menuId         AS menuId,
      name           AS name,
      content        AS content,
      price          AS price,
      menuPictureUrl AS menuPictureUrl,
      createdDate    AS createdDate
      -- , modifiedDate AS modifiedDate
    FROM Menu
    WHERE NVL(IS_DELETE, 'N') = 'N'
    ORDER BY menuId DESC
  </select>

  <!-- 단건 조회 -->
  <select id="findMenuById" parameterType="long" resultType="com.cafein.menu.MenuDTO">
    SELECT
      menuId         AS menuId,
      name           AS name,
      content        AS content,
      price          AS price,
      menuPictureUrl AS menuPictureUrl,
      createdDate    AS createdDate
      -- , modifiedDate AS modifiedDate
    FROM Menu
    WHERE menuId = #{id}
  </select>

  <!-- 수정 -->
  <update id="updateMenu" parameterType="com.cafein.menu.MenuDTO">
    UPDATE Menu
    <set>
      <if test="name != null">name = #{name},</if>
      <if test="content != null">content = #{content},</if>
      <if test="price != null">price = #{price},</if>
      <if test="menuPictureUrl != null">menuPictureUrl = #{menuPictureUrl, jdbcType=CLOB},</if>
      <!-- modifiedDate 컬럼이 있을 때만 사용 -->
      <!-- modifiedDate = SYSDATE -->
    </set>
    WHERE menuId = #{menuId}
  </update>

  <!-- 삭제를 소프트삭제로 -->
  <update id="deleteMenu" parameterType="long">
    UPDATE Menu
       SET IS_DELETE = 'Y'
     WHERE menuId = #{id}
  </update>

</mapper>
